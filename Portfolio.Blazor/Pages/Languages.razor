@page "/languages"
@inject HttpClient http
@inject ProjectApiService portfolioApi
@inject NavigationManager navManager
@using Portfolio.Shared
@using Portfolio.Shared.ViewModels 

<h3>Languages</h3>

<div>
    @foreach(var lan in languages)
    {
        <br />
        <label><a class="text-primary" @onclick="() => NavigateToSingleLanguagePage(lan.Id)">@lan.Name</a></label>
        <button @onclick="() => deleteLanguageFromDatabase(lan)">Delete</button>
    }
</div>

@code {
    private IEnumerable<Language> languages = new List<Language>();

    protected override async Task OnInitializedAsync()
    {
        languages = await portfolioApi.GetLanguageAsync();
        languages.Distinct();
    }

    private async Task deleteLanguageFromDatabase(Language language)
    {
        await portfolioApi.DeleteLanguageAsync(language);
        await RefreshLanguageAsync();
    }

    public void NavigateToSingleLanguagePage(int Id)
    {
        navManager.NavigateTo("languages/" + Id);
    }

    private async Task RefreshLanguageAsync()
    {
        languages = await portfolioApi.GetLanguageAsync();
        languages.Distinct();
    }
}
